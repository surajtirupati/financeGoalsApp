{% extends "base.html" %}

{% block content %}

<form method="POST" action="">
    {{ form.hidden_tag() }}
    <fieldset class="form-group">

        <div class="jumbotron jumbotron-fluid">
          <div class="container">
            <h1 class="display-4">View and edit your finances</h1>
            <p class="lead">This section details your financial data such as gross salary, take home pay, income
            after fixed costs (personal income), and savings. You can edit the metrics in the table by altering the
            number and pressing the 'Update' button. You can also add and delete new fixed costs and financial goals.</p>
          </div>
        </div>

        <header>
            <h5>General</h5>
        </header>

        <div class="row">
            <table class="table table-striped">
                    <thead>
                        <tr>
                            <th scope="col">#</th>
                            <th scope="col">Gross Salary</th>
                            <th scope="col">Disposable Income (Take Home Pay)</th>
                            <th scope="col">Annual Fixed Costs</th>
                            <th scope="col">Personal Income</th>
                            <th scope="col">% of P.I to Save</th>
                            <th scope="col">Annual Savings</th>
                            <th scope="col">Student Plan</th>
                            <th scope="col">Pension Contribution</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <th scope="row">*</th>
                            <td>
                                {% if form.gross_salary.errors %}
                                {{ form.gross_salary(class="form-control form-control-sm is-invalid", value=financial_data.gross_salary) }}
                                <div class="invalid feedback">
                                    {% for error in form.gross_salary.errors %}
                                        <span> {{ error }} </span>
                                    {% endfor %}
                                </div>
                                {% else %}
                                    {{ form.gross_salary(class="form-control form-control-sm", value=financial_data.gross_salary) }}
                                {% endif %}
                            </td>
                            <td>{{ financial_data.disposable_income }}</td>
                            <td>{{ 12 * financial_data.total_fixed_costs }}</td>
                            <td>{{ (12 * financial_data.personal_income)|round(2) }}</td>
                            <td>
                                {% if form.saving_percentage.errors %}
                                {{ form.saving_percentage(class="form-control form-control-sm is-invalid", value=financial_data.saving_percentage) }}
                                <div class="invalid feedback">
                                    {% for error in form.saving_percentage.errors %}
                                        <span> {{ error }} </span>
                                    {% endfor %}
                                </div>
                                {% else %}
                                    {{ form.saving_percentage(class="form-control form-control-sm", value=financial_data.saving_percentage) }}
                                {% endif %}
                            </td>
                            <td>{{ (12 * financial_data.saving_income)|round(2) }}</td>
                            <td>{{ form.student_plan(class="form-control form-control-sm", value=financial_data.student_plan) }}</td>
                            <td>{{ form.pension_contribution(class="form-control form-control-sm", value=financial_data.pension_contribution) }}</td>
                        </tr>
                    </tbody>
            </table>

            <form class="form-inline" method="POST">
                <div class="col text-center">
                    <div class="form-group">
                        {{ form.update(class="btn btn-primary mb-2") }}
                    </div>
                </div>
            </form>
        </div>

        <div class="row">

            <div class="col-md-6">
                <header>
                    <h5>Fixed Costs</h5>
                </header>

                {% if fc_data %}
                <table class="table table-striped">
                    <thead>
                        <tr>
                            <th scope="col">#</th>
                            <th scope="col">Fixed Cost</th>
                            <th scope="col">Monthly Amount</th>
                            <th scope="col">Annual Amount</th>
                        </tr>
                    </thead>
                    <tbody>
                    {% for fc in fc_data %}
                        <tr>
                            <th scope="row">{{ fc.id }}</th>
                            <td>{{ fc.name }}</td>
                            <td>{{ fc.amount }}</td>
                            <td>{{ 12 * fc.amount }}</td>
                        </tr>
                    {% endfor %}
                        <tr>
                            <th scope="row">*</th>
                            <td>Total</td>
                            <td>{{ total_fc }}</td>
                            <td>{{ 12 * total_fc }}</td>
                        </tr>
                    </tbody>
                </table>
                {% endif %}

                <form class="form-inline" method="POST">
                  <div class="input-group">
                      <div class="form-group">
                        {% if fc_form.fc_name.errors %}
                            {{ fc_form.fc_name(class="form-control form-control is-invalid", placeholder="Fixed Cost") }}
                            <div class="invalid feedback">
                                {% for error in fc_form.fc_name.errors %}
                                    <span> {{ error }} </span>
                                {% endfor %}
                            </div>
                        {% else %}
                            {{ fc_form.fc_name(class="form-control form-control", placeholder="Fixed Cost") }}
                        {% endif %}
                      </div>
                      <div class="form-group">
                        {% if fc_form.amount.errors %}
                            {{ fc_form.amount(class="form-control form-control is-invalid", placeholder="Amount") }}
                            <div class="invalid feedback">
                                {% for error in fc_form.amount.errors %}
                                    <span> {{ error }} </span>
                                {% endfor %}
                            </div>
                        {% else %}
                            {{ fc_form.amount(class="form-control form-control", placeholder="Amount") }}
                        {% endif %}
                      </div>
                      <div class="form-group">
                          {{ fc_form.submit(class="btn btn-primary mb-2") }}
                      </div>
                  </div>
                </form>

            </div>

            <div class="col-md-6">
                <header>
                    <h5>Goals</h5>
                </header>

                {% if goal_data %}
                <table class="table table-striped">
                    <thead>
                        <tr>
                            <th scope="col">#</th>
                            <th scope="col">Goal</th>
                            <th scope="col">% of Saving Income</th>
                            <th scope="col">Monthly Amount</th>
                            <th scope="col">Annual Amount</th>
                        </tr>
                    </thead>
                    {% for goal in goal_data %}
                    <tbody>
                        <tr>
                            <th scope="row">{{ goal.id }}</th>
                            <td>{{ goal.name }}</td>
                            <td>{{ 100 * goal.amount }}%</td>
                            <td>{{ (goal.amount * saving_income)|int}}</td>
                            <td>{{ 12 * (goal.amount * saving_income)|int}}</td>
                        </tr>
                    </tbody>
                    {% endfor %}
                </table>
                {% endif %}

                <form class="form-inline" method="POST">
                  <div class="input-group">
                      <div class="form-group">
                        {% if goals_form.goal_name.errors %}
                            {{ goals_form.goal_name(class="form-control form-control is-invalid", placeholder="Goal") }}
                            <div class="invalid feedback">
                                {% for error in goals_form.goal_name.errors %}
                                    <span> {{ error }} </span>
                                {% endfor %}
                            </div>
                        {% else %}
                            {{ goals_form.goal_name(class="form-control form-control", placeholder="Goal") }}
                        {% endif %}
                      </div>
                      <div class="form-group">
                        {% if goals_form.amount.errors %}
                            {{ goals_form.amount(class="form-control form-control is-invalid", placeholder="% of Saving Income") }}
                            <div class="invalid feedback">
                                {% for error in goals_form.amount.errors %}
                                    <span> {{ error }} </span>
                                {% endfor %}
                            </div>
                        {% else %}
                            {{ goals_form.amount(class="form-control form-control", placeholder="% of Saving Income") }}
                        {% endif %}
                      </div>
                      <div class="form-group">
                          {{ goals_form.submit_goal(class="btn btn-primary mb-2") }}
                      </div>
                  </div>
                </form>

            </div>

        </div>


    </fieldset>
</form>

{% endblock %}